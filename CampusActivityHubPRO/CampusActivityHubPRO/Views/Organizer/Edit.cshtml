@using CampusActivityHubPRO.Data
@model CampusActivityHubPRO.Data.Event
@{
    Layout = "_Layout";
}
<h2>Редагувати подію</h2>
@* вставити прямо під <h2> *@
@{
    var errors = ViewData.ModelState.Values.SelectMany(v => v.Errors).Select(e => e.ErrorMessage).ToList();
}
@if (errors.Any())
{
    <div class="alert alert-danger">
        <ul class="mb-0">
            @foreach (var err in errors)
            {
                <li>@err</li>
            }
        </ul>
    </div>
}

<form action="@Url.Action("Edit", "Organizer", new { id = Model.Id })" method="post" enctype="multipart/form-data" class="row g-3">
    @Html.AntiForgeryToken()
    <input type="hidden" asp-for="Id" />
    <div class="col-md-8">
        <label class="form-label">Назва</label>
        <input asp-for="Title" class="form-control" />
        <span asp-validation-for="Title" class="text-danger"></span>
    </div>

    <div class="col-md-4">
        <label class="form-label">Ліміт учасників</label>
        <input asp-for="Capacity" class="form-control" />
    </div>

    <div class="col-12">
        <label class="form-label">Опис</label>
        <textarea asp-for="Description" class="form-control" rows="4"></textarea>
    </div>

    <div class="col-md-6">
        <label class="form-label">Початок</label>
        <input asp-for="StartAt" type="datetime-local" class="form-control" value="@Model.StartAt.ToLocalTime().ToString("yyyy-MM-ddTHH:mm")" />
    </div>
    <div class="col-md-6">
        <label class="form-label">Кінець</label>
        <input asp-for="EndAt" type="datetime-local" class="form-control" value="@Model.EndAt.ToLocalTime().ToString("yyyy-MM-ddTHH:mm")" />
    </div>

    <div class="col-md-6">
        <label class="form-label">Категорія</label>
        <select asp-for="CategoryId" class="form-select">
            <option value="">Оберіть...</option>
            @foreach (var c in ViewBag.Categories as List<CampusActivityHubPRO.Data.Category>)
            {
                <option value="@c.Id" selected="@(c.Id == Model.CategoryId ? "selected" : null)">@c.Name</option>
            }
        </select>
    </div>

    <div class="col-md-6">
        <label class="form-label">Постер (залиште порожнім щоб не змінювати)</label>
        <input type="file" name="poster" class="form-control" />
        @if (!string.IsNullOrEmpty(Model.PosterPath))
        {
            <div class="mt-2">
                <img src="@Model.PosterPath" class="img-thumbnail" style="max-height:150px" />
            </div>
        }
    </div>

    <div class="col-12">
        <label class="form-label">Теги</label>
        <div>
            @foreach (var t in ViewBag.Tags as List<CampusActivityHubPRO.Data.Tag>)
            {
                var isChecked = Model.EventTags?.Any(et => et.TagId == t.Id) ?? false;
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" name="selectedTags" value="@t.Id" id="tag@t.Id" @(isChecked ? "checked" : "") />
                    <label class="form-check-label" for="tag@t.Id">@t.Name</label>
                </div>
            }
        </div>
    </div>

    <div class="col-12">
        <button type="submit" class="btn btn-primary">Зберегти</button>
        <a class="btn btn-secondary" href="/Organizer/MyEvents">Назад</a>
    </div>
</form>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
