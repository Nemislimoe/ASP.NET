@page
@model Lab7.Pages.Orders.IndexModel
<h2>Orders</h2>

<form method="get">
    <input asp-for="CustomerFilter" placeholder="Customer name" />
    <select asp-for="SortOrder">
        <option value="date_desc">Newest first</option>
        <option value="date_asc">Oldest first</option>
    </select>
    <button type="submit">Apply</button>
</form>

<table>
    <thead><tr><th>Date</th><th>Customer</th><th>Products</th></tr></thead>
    <tbody>
        @foreach (var o in Model.Orders)
        {
            <tr>
                <td>@o.OrderDate.ToString("yyyy-MM-dd")</td>
                <td>@o.CustomerName</td>
                <td>
                    <ul>
                        @foreach (var op in o.OrderProducts)
                        {
                            <li>@op.Product.Title x @op.Quantity (@op.Product.Price)</li>
                        }
                    </ul>
                </td>
            </tr>
        }
    </tbody>
</table>

<div>
    Page @Model.PageIndex of @Model.TotalPages
    @if (Model.PageIndex > 1)
    {
        <a asp-page="./Index" asp-route-PageIndex="@(Model.PageIndex-1)" asp-route-CustomerFilter="@Model.CustomerFilter" asp-route-SortOrder="@Model.SortOrder">Prev</a>
    }
    @if (Model.PageIndex < Model.TotalPages)
    {
        <a asp-page="./Index" asp-route-PageIndex="@(Model.PageIndex+1)" asp-route-CustomerFilter="@Model.CustomerFilter" asp-route-SortOrder="@Model.SortOrder">Next</a>
    }
</div>
